# 1. Базовый образ Python
# Используем slim-версию для уменьшения размера образа.
# Замени "3.10" на твою версию Python, если она другая.
FROM python:3.11.12

# 2. Установка переменных окружения для Python
# PYTHONUNBUFFERED: чтобы логи Python выводились сразу, а не буферизировались.
# PYTHONDONTWRITEBYTECODE: чтобы Python не создавал .pyc файлы.
ENV PYTHONUNBUFFERED 1
ENV PYTHONDONTWRITEBYTECODE 1

# 3. Установка рабочей директории внутри контейнера
WORKDIR /app

# 4. Копирование файла зависимостей и их установка
# Копируем сначала только requirements.txt, чтобы Docker мог использовать кэш этого слоя,
# если сам файл не менялся, даже если менялись другие файлы проекта.
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 5. Копирование всего кода проекта в рабочую директорию /app
# Это включает папки alembic, app и файл alembic.ini
COPY . .

# 6. Указание порта, который будет "слушать" приложение
# Стандартный порт для FastAPI/Uvicorn часто 8000. Если у тебя другой, измени его.
EXPOSE 8000

# 7. Команда для запуска приложения
# uvicorn app.main:app --host 0.0.0.0 --port 8000
# - app.main:app: указывает на экземпляр FastAPI 'app' в файле 'app/main.py'.
#   Если твой главный файл или имя экземпляра FastAPI другое, скорректируй.
# - --host 0.0.0.0: делает приложение доступным снаружи контейнера.
# - --port 8000: порт внутри контейнера, на котором запускается Uvicorn.
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]